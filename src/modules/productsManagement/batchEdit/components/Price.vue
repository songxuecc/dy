<!-- 库存 -->
<template>
  <div>
    <el-form ref="form" :model="form" size="small" label-position="left">
      <el-form-item>
        <el-radio v-model="form.is_formula" @change="handleIsFormulaChange" :label="1" class="flex align-c">
          <span class="flex align-c"><span class="color-4e font-12">按照公式修改&nbsp;<span class="bold">原价</span>
            <span class="font-12 ml-5 mr-5">x&nbsp;</span>
          </span>
          <el-input
            style="width: 95px"
            :max="99999999"
            v-model="form.origin_price_rate"
            @focus="handleIsFormulaFocus"
            clearable
            @clear="handleClear('origin_price_rate')"
            @blur="handleBlur($event,'origin_price_rate')"
            class="price"
          >
            <template slot="append">%</template>
          </el-input>
          <span class="color-4e font-14 ml-5 mr-5">&nbsp;+&nbsp;</span>
          <el-input
            style="width: 95px"
            :max="99999999"
            v-model="form.incr_diff"
            @focus="handleIsFormulaFocus"
            clearable
            @clear="handleClear('incr_diff')"
            @blur="handleBlur($event,'incr_diff')"
          class="price"
          >
            <template slot="append">元</template>
          </el-input>
          <span class="color-4e font-18 ml-5 mr-5">&nbsp;-&nbsp;</span>
          <el-input
            style="width: 95px"
            :max="99999999"
            v-model="form.desc_diff"
            @focus="handleIsFormulaFocus"
            clearable
            @clear="handleClear('desc_diff')"
            @blur="handleBlur($event,'desc_diff')"
          class="price"
          >
            <template slot="append">元</template>
          </el-input>
              </span>
        </el-radio>
      </el-form-item>
      <el-form-item>
        <el-radio
          v-model="form.is_every_price"
          @change="handleIsEveryPriceChange"
          :label="1"
          class="flex align-c"
        >
        <span class="flex align-c">
          <span class="color-4e font-12">价格统一为&nbsp;&nbsp;</span>
          <el-input
            class="price"
            style="width: 390px"
            v-model="form.every_price"
            :max="99999999"
            @focus="handleIsEveryPriceFocus"
            clearable
            @clear="handleClear('every_price')"
            @blur="handleBlur($event,'every_price')"
          >
            <template slot="append">元</template>
          </el-input>
              </span>

        </el-radio>
      </el-form-item>

      <el-form-item label="误操作防范：">
        <el-checkbox v-model="form.is_open_min_price" style="display: block">
          <el-form-item label="新价格不低于">
            <el-tooltip
              content="若此处填10，当新价格低于10元，则将新价格调整为10"
              placement="right"
            >
              <el-input
                :max="99999999"
                style="width: 289px"
                v-model="form.min_price"
                @focus="handlChecked('is_open_min_price')"
                clearable
                @clear="handleClear('min_price')"
                @blur="handleBlur($event,'min_price')"
              class="price"
          >
            <template slot="append">元</template>
          </el-input>
            </el-tooltip>
          </el-form-item>
        </el-checkbox>
        <el-checkbox
          v-model="form.is_open_min_price_rate"
          style="margin-left: 84px; display: block; margin-top: 5px"
        >
          <el-form-item label="新价格不低于原价的">
            <el-tooltip
              content="若此处填200，当新价格低于原价的2倍时，则将新价格调整为原价的2倍"
              placement="right"
            >
              <el-input
                :max="99999999"
                style="width: 254px"
                @focus="handlChecked('is_open_min_price_rate')"
                v-model="form.min_price_rate"
                clearable
                @clear="handleClear('min_price_rate')"
                @blur="handleBlur($event,'min_price_rate')"
              class="price"
          >
            <template slot="append">%</template>
          </el-input>
            </el-tooltip>
          </el-form-item>
        </el-checkbox>
      </el-form-item>
    </el-form>
    <p class="tip mt-10">
      <span class="fail">*</span
      >注：为保证审核通过，修改后划线价自动调为sku最高价，售卖价调为sku最低价。
    </p>
  </div>
</template>

<script>
import utils from '@/common/utils'
export default {
  name: 'Stocks',
  props: {
    msg: String
  },
  data () {
    return {
      form: {
        is_formula: 1,
        origin_price_rate: '',
        incr_diff: '',
        desc_diff: '',
        is_every_price: 0,
        every_price: '',
        is_open_min_price: false,
        min_price: '',
        is_open_min_price_rate: false,
        min_price_rate: ''
      }
    }
  },
  methods: {
    handleIsFormulaChange (value) {
      if (this.form.is_formula) {
        this.form.is_every_price = 0
      } else {
        this.form.is_every_price = 1
      }
    },
    handleIsFormulaFocus () {
      this.form.is_formula = 1
      this.form.is_every_price = 0
    },
    handleIsEveryPriceChange (value) {
      if (this.form.is_every_price) {
        this.form.is_formula = 0
      } else {
        this.form.is_formula = 1
      }
    },
    handleIsEveryPriceFocus () {
      this.form.is_formula = 0
      this.form.is_every_price = 1
    },
    handlChecked (attribute) {
      this.form[attribute] = true
    },
    handleClear (attribute) {
      this.form[attribute] = ''
    },
    handleBlur (e, attribute) {
      if (utils.isNumber(e.target.value)) {
        this.form[attribute] = e.target.value
      } else {
        this.$message.error('请输入数字')
      }
    },
    getForm () {
      if (!this.form.is_formula && !this.form.is_every_price) {
        this.$message.error('请选择价格修改方式')
        return false
      } else if (this.form.is_formula && !this.form.origin_price_rate) {
        this.$message.error('请填写价格公式')
        return false
      } else if (this.form.is_every_price && !this.form.every_price) {
        this.$message.error('请填写统一价格')
        return false
      }

      return {
        ...this.form,
        is_formula: Number(this.form.is_formula),
        is_every_price: Number(this.form.is_every_price),
        is_open_min_price: Number(this.form.is_open_min_price),
        is_open_min_price_rate: Number(this.form.is_open_min_price_rate),
        every_price: utils.yuanToFen(this.form.every_price),
        min_price: utils.yuanToFen(this.form.min_price),
        origin_price_rate: utils.yuanToFen(this.form.origin_price_rate),
        incr_diff: utils.yuanToFen(this.form.incr_diff || 0),
        desc_diff: utils.yuanToFen(this.form.desc_diff || 0),
        min_price_rate: utils.yuanToFen(this.form.min_price_rate)
      }
    }
  }
}
</script>
<style lang="less" scoped>
.block {
  display: inline-block;
}

.tip {
  width: 441px;
  height: 16px;
  font-size: 12px;
  color: #4e4e4e;
  line-height: 16px;
}
/deep/ .el-input-number__increase {
  display: none;
}
/deep/ .el-input-number__decrease {
  display: none;
}
/deep/ .el-input .el-input__inner {
  text-align: left;
}
/deep/ .el-input-number .el-input__inner {
  padding-left: 10px;
  padding-right: 10px;
}
/deep/ .el-input-group__append {
    background: none;
    padding: 0;
    padding-right: 10px;
  }

  .price {
    /deep/ .el-input__inner {
      border-right: none;
      padding: 5px;
      padding-left: 10px;
    }

  }
</style>
